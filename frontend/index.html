<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Peças Pesadas - Trator Peças</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link rel="stylesheet" href="./assets/css/style.css" />

    <style>
      .carrossel-container {
        position: relative;
        display: flex;
        align-items: center;
      }
      .carrossel-track {
        display: flex;
        overflow-x: auto;
        gap: 15px;
        padding: 15px 5px;
        scroll-behavior: smooth;
        flex-wrap: nowrap;
        width: 100%;
      }
      .carrossel-track::-webkit-scrollbar {
        display: none;
      }
      .btn-carrossel {
        background: rgba(255, 102, 0, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        position: absolute;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
      }
      .btn-carrossel:hover {
        background: rgba(204, 82, 0, 1);
      }
      .btn-carrossel.left {
        left: -10px;
      }
      .btn-carrossel.right {
        right: -10px;
      }

    </style>
  </head>

  <body>
    <div class="barra-anuncio">
      <div class="container">
        <p>
          <i class="fas fa-shipping-fast"></i> Enviamos para todo o Brasil |
          <i class="fab fa-whatsapp"></i> Atendimento Especializado
        </p>
      </div>
    </div>

    <header class="cabecalho-principal">
      <div class="container">
        <div class="topo-cabecalho">
          <a href="index.html" class="logo-empresa">
            <img
              src="./assets/images/SITE-LOGO-ESTENDIDA.-PNG-2048x819.png"
              alt="Logo Empresa"
            />
          </a>

          <div class="barra-busca">
            <input
              type="text"
              id="campoBusca"
              placeholder="Buscar peça, código ou máquina..."
            />
            <button class="botao-buscar" id="botaoBuscar">
              <i class="fas fa-search"></i>
            </button>
          </div>

          <div class="acoes-usuario">
            <div class="header-btn-container">
              <a href="cadastro.html" class="header-btn-trigger" id="btnAuth">
                <div class="header-icon-svg">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="28"
                    height="28"
                    fill="#000000"
                    viewBox="0 0 256 256"
                  >
                    <path
                      d="M230.93,220a8,8,0,0,1-6.93,4H32a8,8,0,0,1-6.92-12c15.23-26.33,38.7-45.21,66.09-54.16a72,72,0,1,1,73.66,0c27.39,8.95,50.86,27.83,66.09,54.16A8,8,0,0,1,230.93,220Z"
                    ></path>
                  </svg>
                </div>
                <div class="header-text" id="txtAuth">
                  <strong>Entre</strong> ou<br /><strong>Cadastre-se</strong>
                </div>
              </a>

              <div class="login-dropdown-content" id="loginDropdown">
                <div class="dropdown-arrow">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    fill="#fff"
                    viewBox="0 0 256 256"
                  >
                    <path
                      d="M215.39,163.06A8,8,0,0,1,208,168H48a8,8,0,0,1-5.66-13.66l80-80a8,8,0,0,1,11.32,0l80,80A8,8,0,0,1,215.39,163.06Z"
                    ></path>
                  </svg>
                </div>
                <div class="dropdown-box-inner">
                  <span class="dropdown-title"
                    >Já possui cadastro?<br />Acesse sua conta</span
                  >
                  <a href="login.html" class="btn-entrar-full">ENTRAR</a>
                  <div class="dropdown-bottom-links">
                    <a href="cadastro.html" title="Cadastrar"
                      >Cliente novo? <strong>Cadastrar</strong></a
                    >
                    <a href="login.html?pedidos=true" title="Consultar pedido"
                      >Consulte seu pedido <strong>acompanhe aqui</strong></a
                    >
                  </div>
                </div>
              </div>
            </div>

            <div class="header-btn-container">
              <a
                href="#"
                class="header-btn-trigger"
                onclick="toggleCarrinho(event)"
              >
                <div class="header-icon-svg">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="28"
                    height="28"
                    fill="#000000"
                    viewBox="0 0 256 256"
                  >
                    <path
                      d="M222.14,58.87A8,8,0,0,0,216,56H54.68L49.79,29.14A16,16,0,0,0,34.05,16H16a8,8,0,0,0,0,16h18L59.56,172.29a24,24,0,0,0,5.33,11.27,28,28,0,1,0,44.4,8.44h45.42A27.75,27.75,0,0,0,152,204a28,28,0,1,0,28-28H83.17a8,8,0,0,1-7.87-6.57L72.13,152h116a24,24,0,0,0,23.61-19.71l12.16-66.86A8,8,0,0,0,222.14,58.87ZM96,204a12,12,0,1,1-12-12A12,12,0,0,1,96,204Zm96,0a12,12,0,1,1-12-12A12,12,0,0,1,192,204Zm4-74.57A8,8,0,0,1,188.1,136H69.22L57.59,72H206.41Z"
                    ></path>
                  </svg>
                  <span class="badge-carrinho" id="badgeCarrinhoLoja">0</span>
                </div>
                <div class="header-text">
                  <strong>Meu</strong><br />Carrinho
                </div>
              </a>
            </div>

            <a
              id="btnLinkAdmin"
              href="admin.html"
              style="
                display: none;
                background-color: #dc3545;
                color: white;
                padding: 5px 10px;
                border-radius: 5px;
                text-decoration: none;
                font-weight: bold;
                margin-left: 10px;
                align-items: center;
                height: 40px;
              "
            >
              <i class="fas fa-cogs"></i> Painel
            </a>

            <button class="botao-menu-mobile" id="botaoMenuMobile">
              <span></span>
              <span></span>
              <span></span>
            </button>
          </div>
        </div>
      </div>
    </header>


    <div class="barra-marcas" id="barraMarcasContainer">
      <span style="color: #fff; padding: 10px">Carregando marcas...</span>
    </div>

    <div id="menuMaisMarcas" class="menu-marcas-superposto"></div>

    <div id="menuCategoriasFlutuante" class="menu-cat-dropdown">
      <div class="menu-cat-header" id="tituloMarcaDropdown">Categorias</div>

      <div class="lista-cat-scroll" id="listaCategoriasContainer">
        <p style="padding: 10px; color: #666">Carregando...</p>
      </div>
    </div>

    <section
      class="hero-slider"
      style="
        position: relative;
        width: 100%;
        max-width: 1920px;
        margin: 0 auto;
        overflow: hidden;
      "
    >
      <div
        id="banner-track"
        style="
          display: flex;
          transition: transform 0.5s ease-in-out;
          height: 400px;
          background: #eee;
        "
      >
        <div
          style="
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
          "
        >
          Carregando Banners...
        </div>
      </div>

      <button
        id="btnPrev"
        style="
          position: absolute;
          left: 10px;
          top: 50%;
          transform: translateY(-50%);
          background: rgba(0, 0, 0, 0.5);
          color: white;
          border: none;
          padding: 15px;
          cursor: pointer;
          font-size: 24px;
          border-radius: 4px;
          z-index: 10;
        "
      >
        ❮
      </button>
      <button
        id="btnNext"
        style="
          position: absolute;
          right: 10px;
          top: 50%;
          transform: translateY(-50%);
          background: rgba(0, 0, 0, 0.5);
          color: white;
          border: none;
          padding: 15px;
          cursor: pointer;
          font-size: 24px;
          border-radius: 4px;
          z-index: 10;
        "
      >
        ❯
      </button>
    </section>

    <section class="secao-loja vitrines-home">
      <div class="container">
        <div class="vitrine-secao" id="secao-lancamentos" style="display: none">
          <h2 class="titulo-vitrine">Lançamentos</h2>
          <div class="carrossel-container">
            <button
              class="btn-carrossel left"
              onclick="scrollVitrine(this, 'left')"
            >
              <i class="fas fa-chevron-left"></i>
            </button>
            <div class="carrossel-track" id="vitrine-lancamentos"></div>
            <button
              class="btn-carrossel right"
              onclick="scrollVitrine(this, 'right')"
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>

        <div class="vitrine-secao" id="secao-destaques" style="display: none">
          <h2 class="titulo-vitrine">Destaques da Semana</h2>
          <div class="carrossel-container">
            <button
              class="btn-carrossel left"
              onclick="scrollVitrine(this, 'left')"
            >
              <i class="fas fa-chevron-left"></i>
            </button>
            <div class="carrossel-track" id="vitrine-destaques"></div>
            <button
              class="btn-carrossel right"
              onclick="scrollVitrine(this, 'right')"
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>

        <div class="vitrine-secao" id="secao-ofertas" style="display: none">
          <h2 class="titulo-vitrine">Ofertas</h2>
          <div class="carrossel-container">
            <button
              class="btn-carrossel left"
              onclick="scrollVitrine(this, 'left')"
            >
              <i class="fas fa-chevron-left"></i>
            </button>
            <div class="carrossel-track" id="vitrine-ofertas"></div>
            <button
              class="btn-carrossel right"
              onclick="scrollVitrine(this, 'right')"
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>

        <div class="vitrine-secao" id="secao-interesses" style="display: none">
          <h2 class="titulo-vitrine">Você também pode estar interessado</h2>
          <div class="carrossel-container">
            <button
              class="btn-carrossel left"
              onclick="scrollVitrine(this, 'left')"
            >
              <i class="fas fa-chevron-left"></i>
            </button>
            <div class="carrossel-track" id="vitrine-interesses"></div>
            <button
              class="btn-carrossel right"
              onclick="scrollVitrine(this, 'right')"
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>

        <div
          class="vitrine-secao"
          id="secao-mais-vendidos"
          style="display: none"
        >
          <h2 class="titulo-vitrine">Mais Vendidos do Mês</h2>
          <div class="carrossel-container">
            <button
              class="btn-carrossel left"
              onclick="scrollVitrine(this, 'left')"
            >
              <i class="fas fa-chevron-left"></i>
            </button>
            <div class="carrossel-track" id="vitrine-mais-vendidos"></div>
            <button
              class="btn-carrossel right"
              onclick="scrollVitrine(this, 'right')"
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>

        <div class="centralizado" style="margin-top: 40px">
          <a href="loja.html" class="botao botao-outline-pequeno"
            >Ver todos os produtos da loja</a
          >
        </div>
      </div>
    </section>

    <div class="barra-beneficios">
      <div class="container">
        <div class="grade-beneficios">
          <div class="item-beneficio">
            <i class="fas fa-truck"></i>
            <div>
              <strong>Envio Imediato</strong>
              <small>Despachamos em 24h</small>
            </div>
          </div>
          <div class="item-beneficio">
            <i class="fas fa-credit-card"></i>
            <div>
              <strong>Parcele em até 12x</strong>
              <small>Cartões de crédito</small>
            </div>
          </div>
          <div class="item-beneficio">
            <i class="fas fa-shield-alt"></i>
            <div>
              <strong>Compra Segura</strong>
              <small>Dados protegidos</small>
            </div>
          </div>
          <div class="item-beneficio">
            <i class="fas fa-tags"></i>
            <div>
              <strong>5% no PIX</strong>
              <small>Desconto à vista</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <section class="cta-banner">
      <div class="container conteudo-cta">
        <div class="texto-cta">
          <h2>Não encontrou a peça que precisa?</h2>
          <p>Fale com um consultor agora mesmo!</p>
        </div>
        <a
          href="https://wa.me/554984276503?text=Ol%C3%A1%20tudo%20bem?"
          class="botao botao-outline botao-grande"
          ><i class="fab fa-whatsapp"></i> Falar no WhatsApp</a
        >
      </div>
    </section>

    <section class="secao-sobre">
      <div class="container conteudo-sobre">
        <div class="imagem-sobre">
          <i
            class="fas fa-cogs"
            style="font-size: 8rem; color: rgba(0, 86, 179, 0.15)"
          ></i>

          <div
            class="card-flutuante card-2"
            style="bottom: 30px; right: 30px; top: auto"
          >
            <i class="fas fa-shipping-fast"></i>
            <div>
              <strong>Agilidade na Entrega</strong>
              <span
                style="display: block; font-size: 0.8rem; font-weight: normal"
                >Para todo o Brasil</span
              >
            </div>
          </div>
        </div>

        <div class="texto-sobre">
          <span class="tag-secao">Quem Somos</span>

          <h2>Soluções ágeis para sua máquina não parar</h2>

          <p>
            Na Dispemaq, entendemos que cada hora de equipamento parado impacta
            o seu resultado. Por isso, nossa missão é simples: identificar a
            peça correta e entregá-la com a máxima agilidade. Trabalhamos com
            uma seleção rigorosa de fornecedores para garantir durabilidade e
            desempenho.
          </p>

          <div class="lista-diferenciais">
            <div class="item-diferencial">
              <i class="fas fa-check"></i> Peças de reposição linha Premium
            </div>
            <div class="item-diferencial">
              <i class="fas fa-check"></i> Cotação rápida e sem burocracia
            </div>
            <div class="item-diferencial">
              <i class="fas fa-check"></i> Consultoria técnica na venda
            </div>
          </div>

          <div class="estatisticas-sobre">
            <div class="stat-item">
              <i
                class="fas fa-award"
                style="
                  font-size: 1.5rem;
                  color: var(--primary-color);
                  margin-bottom: 5px;
                "
              ></i>
              <strong>Garantia</strong>
              <span>Procedência</span>
            </div>

            <div class="stat-item">
              <i
                class="fas fa-map-marked-alt"
                style="
                  font-size: 1.5rem;
                  color: var(--primary-color);
                  margin-bottom: 5px;
                "
              ></i>
              <strong>Nacional</strong>
              <span>Envio p/ todo país</span>
            </div>

            <div class="stat-item">
              <i
                class="fas fa-boxes"
                style="
                  font-size: 1.5rem;
                  color: var(--primary-color);
                  margin-bottom: 5px;
                "
              ></i>
              <strong>Completo</strong>
              <span>Multimarcas</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="secao-contato" id="contato">
      <div class="container">
        <div class="cabecalho-secao centralizado">
          <h2>Fale Conosco</h2>
          <p>Estamos prontos para te atender pelos nossos canais</p>
        </div>

        <div class="grade-contato">
          <div class="card-contato">
            <div class="icone-contato telefone">
              <i class="fas fa-phone-alt"></i>
            </div>
            <h3>Televendas</h3>
            <p>Fale diretamente com um vendedor</p>
            <a href="tel:+554984276503" class="link-contato">(49) 8427-6503</a>
          </div>

          <div class="card-contato destaque">
            <div class="icone-contato whatsapp">
              <i class="fab fa-whatsapp"></i>
            </div>
            <h3>WhatsApp</h3>
            <p>Atendimento rápido e envio de fotos</p>
            <a
              href="https://wa.me/554984276503?text=Ol%C3%A1%20tudo%20bem?"
              class="link-contato"
              >Iniciar Conversa</a
            >
          </div>

          <div class="card-contato">
            <div class="icone-contato horario">
              <i class="far fa-clock"></i>
            </div>
            <h3>Atendimento</h3>
            <p>Segunda a Sexta: 07:30h às 18h</p>
          </div>
        </div>

        <div class="mapa-local">
          <div class="info-local">
            <h3><i class="fas fa-map-marker-alt"></i> Nossa Loja</h3>
            <p>Rua Camboriú, 99, Cristo Rei, Chapecó SC</p>
            <p>CEP: 89810-152</p>
            <div class="area-atuacao">
              Atendemos todo o território nacional via transportadora.
            </div>
          </div>

          <div class="container-mapa" style="width: 100%; height: 300px">
            <iframe
              width="100%"
              height="100%"
              formborder="0"
              scrolling="no"
              marginheight="0"
              marginwidth="0"
              src="https://maps.google.com/maps?q=Rua%20Camboriú%2C%2099%2C%20Cristo%20Rei%2C%20Chapecó%20SC&t=&z=15&ie=UTF8&iwloc=&output=embed"
              style="border: 0"
              allowfullscreen=""
              loading="lazy"
            >
            </iframe>
          </div>
        </div>
      </div>
    </section>

    <footer class="rodape-principal">
      <div class="container">
        <div class="conteudo-rodape">
          <div class="coluna-rodape">
            <h3>Sobre Nós</h3>
            <p>
              Especialistas em peças de reposição para máquinas pesadas e
              tratores agrícolas. Qualidade e confiança para o seu equipamento.
            </p>
            <div class="redes-sociais">
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-linkedin-in"></i></a>
            </div>
          </div>

          <div class="coluna-rodape">
            <h4>Links Rápidos</h4>
            <ul class="links-rodape">
              <li><a href="./index.html">Início</a></li>
              <li><a href="#">Minha Conta</a></li>
              <li><a href="#">Rastrear Pedido</a></li>
              <li><a href="./trocasDevolucoes.html">Trocas e Devoluções</a></li>
            </ul>
          </div>

          <div class="coluna-rodape">
            <h4>Contato</h4>
            <ul class="info-rodape">
              <li><i class="fas fa-phone-alt"></i> (49) 8427-6503</li>
              <li>
                <i class="fab fa-whatsapp"></i>
                <a
                  href="https://wa.me/554984276503?text=Ol%C3%A1%20tudo%20bem?"
                  class="link-contato"
                  >Iniciar Conversa</a
                >
              </li>
              <li>
                <i class="far fa-envelope"></i> comercial.dispemaq@gmail.com
              </li>
            </ul>
          </div>
        </div>

        <div class="divisor-rodape"></div>

        <div class="rodape-inferior">
          <p>© 2026 Dispemaq. Todos os direitos reservados.</p>
          <div class="formas-pagamento">
            <i class="fab fa-cc-visa"></i>
            <i class="fab fa-cc-mastercard"></i>
            <i class="fas fa-barcode"></i>
            <i class="fas fa-pix"></i>
          </div>
          <div class="links-legais">
            <a href="#">Termos de Uso</a>
            <a href="./politicaDePrivacidade.html">Política de Privacidade</a>
          </div>
        </div>
      </div>
    </footer>

    <div class="overlay-categorias" id="overlay"></div>

    <div class="carrinho-lateral" id="carrinhoLateral">
      <div class="carrinho-header">
        <h3><i class="fas fa-shopping-bag"></i> Seu Carrinho</h3>
        <button class="fechar-carrinho" onclick="toggleCarrinho(event)">
          ×
        </button>
      </div>
      <div class="carrinho-conteudo"></div>
      <div class="carrinho-footer">
        <div class="carrinho-total">
          <span>Total:</span>
          <strong>R$ 0,00</strong>
        </div>
        <button
          class="botao botao-primario botao-block"
          onclick="alert('Finalizar compra em desenvolvimento')"
        >
          Finalizar Compra
        </button>
      </div>
    </div>

    <a href="#" class="whatsapp-flutuante">
      <i class="fab fa-whatsapp"></i>
      <span class="tooltip-whatsapp">Fale Conosco</span>
    </a>

    <button class="botao-topo" id="btnTopo" onclick="subirTopo()">
      <i class="fas fa-arrow-up"></i>
    </button>

    <div
      id="popupAvisoLogin"
      class="overlay-popup"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 9999;
        align-items: center;
        justify-content: center;
      "
    >
      <div
        class="box-popup"
        style="
          background: white;
          padding: 30px;
          border-radius: 10px;
          text-align: center;
          max-width: 400px;
          position: relative;
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        "
      >
        <button
          onclick="
            document.getElementById('popupAvisoLogin').style.display = 'none';
            sessionStorage.setItem('popupFechado', 'true');
          "
          style="
            position: absolute;
            top: 10px;
            right: 15px;
            border: none;
            background: none;
            font-size: 20px;
            cursor: pointer;
          "
        >
          ×
        </button>
        <h3 style="color: #333; margin-bottom: 10px">Bem-vindo à Dispemaq!</h3>
        <p style="color: #666; margin-bottom: 20px">
          Faça login para salvar seus favoritos e ver seus pedidos.
        </p>
        <div>
          <a
            href="cadastro.html"
            style="
              background: #ff6600;
              color: white;
              padding: 10px 20px;
              text-decoration: none;
              border-radius: 5px;
              font-weight: bold;
            "
            >Entrar ou Cadastrar</a
          >
        </div>
      </div>
    </div>

    <script type="module">
      import {
        db,
        doc,
        getDoc,
        collection,
        getDocs,
      } from "./assets/js/firebase-config.js";

      let currentIndex = 0;
      let bannersData = [];
      let intervaloCarrossel;

      document.addEventListener("DOMContentLoaded", async () => {
        await carregarBanners();
        await carregarMenusDinamicos();
        await carregarVitrines();
      });

      async function carregarBanners() {
        const track = document.getElementById("banner-track");
        if (!track) return;

        try {
          const docRef = doc(db, "configuracoes", "banner_site");
          const docSnap = await getDoc(docRef);

          if (docSnap.exists() && docSnap.data().listaBanners) {
            bannersData = docSnap.data().listaBanners;

            if (bannersData.length === 0) {
              track.innerHTML =
                '<div style="display:flex; align-items:center; justify-content:center; width:100%; height:100%; color:#888;">Sem banners cadastrados</div>';
              return;
            }

            track.innerHTML = "";
            bannersData.forEach((banner) => {
              const img = document.createElement("img");
              img.src = banner.img || banner.imagem;
              img.style.width = "100%";
              img.style.height = "100%";
              img.style.objectFit = "cover";
              img.style.flexShrink = "0";
              track.appendChild(img);
            });

            iniciarControles();
          } else {
            track.innerHTML =
              '<div style="display:flex; align-items:center; justify-content:center; width:100%; height:100%; color:#888;">Nenhum banner configurado</div>';
          }
        } catch (error) {
          console.error("Erro ao carregar banners:", error);
        }
      }

      function iniciarControles() {
        const track = document.getElementById("banner-track");
        const btnPrev = document.getElementById("btnPrev");
        const btnNext = document.getElementById("btnNext");
        const total = bannersData.length;

        const updateSlide = () => {
          track.style.transform = `translateX(-${currentIndex * 100}%)`;
        };

        if (btnNext)
          btnNext.addEventListener("click", () => {
            currentIndex = (currentIndex + 1) % total;
            updateSlide();
            resetTimer();
          });

        if (btnPrev)
          btnPrev.addEventListener("click", () => {
            currentIndex = (currentIndex - 1 + total) % total;
            updateSlide();
            resetTimer();
          });

        const startTimer = () => {
          intervaloCarrossel = setInterval(() => {
            currentIndex = (currentIndex + 1) % total;
            updateSlide();
          }, 4000);
        };

        const resetTimer = () => {
          clearInterval(intervaloCarrossel);
          startTimer();
        };

        startTimer();
      }

      async function carregarMenusDinamicos() {
        const barraMarcas = document.getElementById("barraMarcasContainer");
        const menuMaisMarcas = document.getElementById("menuMaisMarcas");
        const listaCategorias = document.getElementById(
          "listaCategoriasContainer",
        );
        const faixaLaranja = document.getElementById("faixaLaranjaCount");
        const spanCount = document.getElementById("countMarcas");

        try {
          const snapMarcas = await getDocs(collection(db, "marcas"));
          let marcas = [];
          snapMarcas.forEach((doc) => marcas.push(doc.data().nome));
          marcas.sort((a, b) => a.localeCompare(b));

          const snapCat = await getDocs(collection(db, "categorias"));
          let categorias = [];
          snapCat.forEach((doc) => categorias.push(doc.data().nome));
          categorias.sort((a, b) => a.localeCompare(b));

          if (marcas.length > 0) {
            if (faixaLaranja) faixaLaranja.style.display = "block";
            if (spanCount) spanCount.innerText = marcas.length;
          }

          if (barraMarcas && menuMaisMarcas) {
            barraMarcas.innerHTML = "";
            menuMaisMarcas.innerHTML = "";

            marcas.forEach((marca, index) => {
              const nomeExibicao = marca.toUpperCase();
              const valorUrl = encodeURIComponent(marca);

              if (index < 8) {
                barraMarcas.innerHTML += `
                              <button class="item-marca" onclick="window.location.href='loja.html?marca=${valorUrl}'">
                                  ${nomeExibicao}
                              </button>
                          `;
              } else {
                menuMaisMarcas.innerHTML += `
                              <button class="marca-item-extra" onclick="window.location.href='loja.html?marca=${valorUrl}'">
                                  ${nomeExibicao}
                              </button>
                          `;
              }
            });

            if (marcas.length > 8) {
              barraMarcas.innerHTML += `
                          <div class="dropdown-marcas">
                              <button id="btnVerMais" class="botao-marcas" onclick="abrirMenuMarcas(event)">
                                  <i class="fas fa-plus-circle"></i> MARCAS
                              </button>
                          </div>
                      `;
            }
          }

          if (listaCategorias) {
            listaCategorias.innerHTML = "";
            categorias.forEach((cat) => {
              listaCategorias.innerHTML += `
                          <button class="item-cat-dropdown" onclick="window.location.href='loja.html?categoria=${encodeURIComponent(cat)}'">
                              <i class="fas fa-chevron-right"></i> ${cat}
                          </button>
                      `;
            });

            listaCategorias.innerHTML += `
                      <button class="item-cat-dropdown destaque" onclick="window.location.href='loja.html'">
                           <strong>Ver Tudo na Loja</strong>
                      </button>
                  `;
          }
        } catch (error) {
          console.error("Erro ao carregar menus:", error);
          if (barraMarcas)
            barraMarcas.innerHTML =
              "<span style='color:#fff; padding:10px;'>Erro ao carregar marcas.</span>";
        }
      }

      window.abrirMenuMarcas = function (event) {
        event.stopPropagation();
        const menu = document.getElementById("menuMaisMarcas");
        const btn = event.currentTarget;

        if (menu.classList.contains("ativo")) {
          menu.classList.remove("ativo");
        } else {
          const rect = btn.getBoundingClientRect();
          menu.style.top = rect.bottom + window.scrollY + 5 + "px";
          menu.style.left = rect.left + window.scrollX - 100 + "px";
          menu.classList.add("ativo");
        }
      };

      document.addEventListener("click", function (e) {
        const menu = document.getElementById("menuMaisMarcas");
        const btn = document.getElementById("btnVerMais");
        if (
          menu &&
          menu.classList.contains("ativo") &&
          e.target !== menu &&
          (!btn || !btn.contains(e.target))
        ) {
          menu.classList.remove("ativo");
        }
      });

      async function carregarVitrines() {
        const tiposVitrines = [
          {
            idHTML: "lancamentos",
            chaves: ["lancamentos", "lançamentos", "lancamento"],
          },
          {
            idHTML: "destaques",
            chaves: [
              "destaques",
              "destaque",
              "destaque_semana",
              "destaques da semana",
            ],
          },
          { idHTML: "ofertas", chaves: ["ofertas", "oferta"] },
          {
            idHTML: "interesses",
            chaves: [
              "interesses",
              "interessar",
              "você também pode estar interessado",
              "voce tambem pode estar interessado",
            ],
          },
          {
            idHTML: "mais-vendidos",
            chaves: [
              "mais-vendidos",
              "mais_vendidos",
              "mais vendidos do mês",
              "mais vendidos do mes",
            ],
          },
        ];

        try {
          const produtosRef = collection(db, "produtos");
          const querySnapshot = await getDocs(produtosRef);

          const todosProdutos = [];
          querySnapshot.forEach((doc) => {
            todosProdutos.push({ id: doc.id, ...doc.data() });
          });

          tiposVitrines.forEach((vitrine) => {
            const secaoVitrine = document.getElementById(
              `secao-${vitrine.idHTML}`,
            );
            const trackVitrine = document.getElementById(
              `vitrine-${vitrine.idHTML}`,
            );

            if (secaoVitrine && trackVitrine) {
              const produtosDestaVitrine = todosProdutos.filter((prod) => {
                if (!prod.vitrines) return false;

                // Transforma em lista mesmo se o admin salvou como texto simples
                const vitrinesDoProduto = Array.isArray(prod.vitrines)
                  ? prod.vitrines
                  : [prod.vitrines];

                // Checa se alguma das formas do nome bate
                return vitrinesDoProduto.some((v) =>
                  vitrine.chaves.includes(String(v).toLowerCase().trim()),
                );
              });

              if (produtosDestaVitrine.length > 0) {
                secaoVitrine.style.display = "block";
                trackVitrine.innerHTML = "";

                // Adiciona os cards encontrados no carrossel
                produtosDestaVitrine.forEach((prod) => {
                  criarCardProduto(prod, trackVitrine);
                });
              }
            }
          });
        } catch (error) {
          console.error("Erro ao carregar vitrines:", error);
        }
      }

      /* --- 4. RENDERIZAÇÃO DO CARD --- */
      function criarCardProduto(p, container) {
        if (!container) return;

        const card = document.createElement("div");
        card.classList.add("produto-card");

        // CORREÇÃO: Transforma o card inteiro em um botão clicável
        card.style.cursor = "pointer";
        card.addEventListener("click", () => {
          window.location.href = `produto.html?id=${p.id}`;
        });

        const imgUrl =
          p.imagem || p.img || p.urlImagem || "./assets/images/sem-foto.png";
        let precoDisplay = "Consulte";

        if (p.preco) {
          let valor = p.preco;
          if (typeof valor === "string") {
            valor = parseFloat(
              valor
                .replace("R$", "")
                .replace(/\./g, "")
                .replace(",", ".")
                .trim(),
            );
          }
          if (!isNaN(valor) && valor > 0) {
            precoDisplay = valor.toLocaleString("pt-BR", {
              style: "currency",
              currency: "BRL",
            });
          } else {
            precoDisplay = p.preco;
          }
        }

        card.innerHTML = `
        <div class="img-container">
            <img src="${imgUrl}" alt="${p.nome}" onerror="this.src='./assets/images/sem-foto.png'">
        </div>
        <div class="produto-info">
            <span class="categoria-tag">${p.marca || p.categoria || "Geral"}</span>
            <h3 title="${p.nome}">${p.nome}</h3>
            <p class="codigo">Cód: ${p.codigo || "--"}</p>
            <div class="preco-box">
                <span class="preco">${precoDisplay}</span>
            </div>
            <button class="botao-comprar btn-add-carrinho">
                <i class="fas fa-shopping-cart"></i> Comprar
            </button>
        </div>
    `;

        const btn = card.querySelector(".btn-add-carrinho");
        if (btn) {
          btn.addEventListener("click", (e) => {
            e.stopPropagation(); // Garante que clicar aqui NÃO abre a página de detalhes, mas sim vai pro carrinho
            addCarrinhoLoja(p.id, p);
          });
        }

        container.appendChild(card);
      }

      // --- CONTROLES DOS CARROSSÉIS DE PRODUTOS ---
      window.scrollVitrine = function (btn, direcao) {
        const container = btn.parentElement.querySelector(".carrossel-track");
        const scrollAmount = 250; // Quantidade de rolagem

        if (direcao === "left") {
          container.scrollBy({ left: -scrollAmount, behavior: "smooth" });
        } else {
          container.scrollBy({ left: scrollAmount, behavior: "smooth" });
        }
      };
    </script>
  </body>
</html>
