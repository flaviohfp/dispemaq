<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loja - Catálogo de Peças</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="./assets/css/style.css" />
  </head>
  <body>
    <div class="barra-anuncio">
      <div class="container">
        <p>
          <i class="fas fa-shipping-fast"></i> Enviamos para todo o Brasil |
          <i class="fab fa-whatsapp"></i> Atendimento Especializado
        </p>
      </div>
    </div>

    <header class="cabecalho-principal">
      <div class="container">
        <div class="topo-cabecalho">
          
          <a href="index.html" class="logo-empresa">
            <img
              src="./assets/images/SITE-LOGO-ESTENDIDA.-PNG-2048x819.png"
              alt="Logo Empresa"
              onerror="this.src='https://via.placeholder.com/200x80?text=Dispemaq'"
            />
          </a>

          <div class="barra-busca">
            <input
              type="text"
              id="campoBuscaLoja"
              placeholder="Buscar peça, código ou máquina..."
            />
            <button class="botao-buscar" id="btnBuscaLoja"><i class="fas fa-search"></i></button>
          </div>

          <div class="acoes-usuario">
            <a href="index.html" class="item-acao">
              <i class="fas fa-home"></i>
              <span>Início</span>
            </a>

            <a href="login.html" class="item-acao" id="btnAuth">
              <i class="fas fa-user-circle" id="iconAuth"></i>
              <span id="txtAuth">Entrar</span>
            </a>

            <a href="#" class="item-acao" onclick="toggleCarrinho(event)">
              <div class="carrinho-botao">
                <i class="fas fa-shopping-cart"></i>
                <span class="badge-carrinho" id="badgeCarrinhoLoja">0</span>
              </div>
              <span>Carrinho</span>
            </a>

            <a href="https://wa.me/" class="item-acao destaque-whatsapp">
              <i class="fab fa-whatsapp"></i>
              <span>Vendas</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <section class="banner-loja-container" style="max-width: 1400px; margin: 0 auto; padding: 10px;">
        <img 
            id="bannerPrincipal" 
            src="./assets/images/banner-padrao.jpg" 
            alt="Ofertas Especiais" 
            style="width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: block;"
            onerror="this.style.display='none'"
        >
    </section>

    <div class="container dyn-layout-loja" style="margin-top: 30px; margin-bottom: 50px;">
        
        <aside class="sidebar-filtros">
            <div class="box-sidebar">
                <h3><i class="fas fa-filter"></i> Filtrar Por</h3>
                
                <div class="grupo-filtro">
                    <h4>Categorias</h4>
                    <ul>
                        <li class="filtro-item" data-cat="todas">Ver Todas</li>
                        <li class="filtro-item" data-cat="motor">Motor</li>
                        <li class="filtro-item" data-cat="hidraulica">Hidráulica</li>
                        <li class="filtro-item" data-cat="transmissao">Transmissão</li>
                        <li class="filtro-item" data-cat="eletrica">Elétrica</li>
                        <li class="filtro-item" data-cat="filtros">Filtros</li>
                        <li class="filtro-item" data-cat="rodante">Material Rodante</li>
                        <li class="filtro-item" data-cat="fps">FPS / Implementos</li>
                    </ul>
                </div>

                <div class="grupo-filtro">
                    <h4>Marcas</h4>
                    <ul>
                        <li class="filtro-item" data-marca="todas">Todas as Marcas</li>
                        <li class="filtro-item" data-marca="caterpillar">Caterpillar</li>
                        <li class="filtro-item" data-marca="komatsu">Komatsu</li>
                        <li class="filtro-item" data-marca="volvo-michigan">Volvo / Michigan</li>
                        <li class="filtro-item" data-marca="case">Case</li>
                        <li class="filtro-item" data-marca="jcb">JCB</li>
                        <li class="filtro-item" data-marca="cummins">Cummins</li>
                        <li class="filtro-item" data-marca="massey">Massey Ferguson</li>
                    </ul>
                </div>
            </div>
        </aside>

        <section class="conteudo-principal-loja">
            <div class="header-resultados">
                <div>
                    <h2 id="tituloResultadoLoja">Todos os Produtos</h2>
                    <p id="qtdResultados" style="color: #666; font-size: 0.9rem;">Carregando...</p>
                </div>
            </div>

            <div id="gradeProdutosLoja" class="dyn-grade-produtos" style="margin-top: 20px;">
                </div>
        </section>
    </div>

    <footer class="rodape-principal">
      <div class="container">
        <div class="conteudo-rodape">
          <div class="coluna-rodape">
            <h3>Sobre Nós</h3>
            <p>Especialistas em peças de reposição para máquinas pesadas e tratores agrícolas.</p>
          </div>
          <div class="coluna-rodape">
            <h4>Links Rápidos</h4>
            <ul class="links-rodape">
              <li><a href="index.html">Início</a></li>
              <li><a href="loja.html">Loja</a></li>
            </ul>
          </div>
          <div class="coluna-rodape">
            <h4>Contato</h4>
            <ul class="info-rodape">
              <li><i class="fas fa-phone-alt"></i> (00) 0000-0000</li>
              <li><i class="fab fa-whatsapp"></i> (00) 90000-0000</li>
            </ul>
          </div>
        </div>
        <div class="rodape-inferior">
          <p>&copy; 2024 Dispemaq. Todos os direitos reservados.</p>
        </div>
      </div>
    </footer>

    <div class="overlay-categorias" id="overlay"></div>
    <div class="carrinho-lateral" id="carrinhoLateral">
        <div class="carrinho-header">
            <h3>Seu Carrinho</h3>
            <button class="fechar-carrinho" onclick="toggleCarrinho(event)">&times;</button>
        </div>
        <div class="carrinho-conteudo" id="itensCarrinhoHtml"></div>
        <div class="carrinho-footer">
            <button class="botao botao-primario botao-block">Finalizar Compra</button>
        </div>
    </div>

    <a href="#" class="whatsapp-flutuante"><i class="fab fa-whatsapp"></i></a>

    <div id="popupAvisoLogin" class="overlay-popup">
        <div class="box-popup">
            <button class="fechar-popup" onclick="fecharPopupLogin()">&times;</button>
            <h3>Bem-vindo à Dispemaq!</h3>
            <p>Faça login para salvar seus favoritos e finalizar compras com agilidade.</p>
            <div class="botoes-popup">
                <a href="login.html" class="botao botao-primario">Fazer Login</a>
                <a href="cadastro.html" class="botao botao-secundario">Criar Conta</a>
            </div>
            <p class="texto-pequeno">Ou feche para apenas navegar &rarr;</p>
        </div>
    </div>

    <style>
        .overlay-popup {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 9999;
            display: none; /* JS controla isso */
            align-items: center; justify-content: center;
        }
        .box-popup {
            background: white; padding: 30px; border-radius: 10px;
            text-align: center; max-width: 400px; width: 90%; position: relative;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .fechar-popup {
            position: absolute; top: 10px; right: 15px; font-size: 28px;
            background: none; border: none; cursor: pointer; color: #666;
        }
        .botoes-popup { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .texto-pequeno { font-size: 12px; color: #999; margin-top: 15px; }
        .botao-secundario { background-color: #666; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;}
        .botao-primario { background-color: #ff6600; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;}
    </style>

    <script type="module" src="./assets/js/loja.js"></script>
    
    <script>
        // Função visual do Carrinho
        function toggleCarrinho(e) {
            if(e) e.preventDefault();
            const sidebar = document.getElementById('carrinhoLateral');
            const overlay = document.getElementById('overlay');
            
            if(sidebar) sidebar.classList.toggle('aberto');
            if(overlay) overlay.classList.toggle('ativo');
        }
        
        const overlay = document.getElementById('overlay');
        if(overlay) {
            overlay.addEventListener('click', () => toggleCarrinho());
        }

        // Função para fechar o popup e lembrar
        window.fecharPopupLogin = function() {
            document.getElementById('popupAvisoLogin').style.display = 'none';
            sessionStorage.setItem('popupFechado', 'true');
        }
    </script>

    <script type="module">
        import { auth, onAuthStateChanged, signOut } from './assets/js/firebase-config.js';

        const btnAuth = document.getElementById('btnAuth');
        const txtAuth = document.getElementById('txtAuth');
        const iconAuth = document.getElementById('iconAuth');
        const popup = document.getElementById('popupAvisoLogin');

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // --- USUÁRIO ESTÁ LOGADO ---
                console.log("Usuário logado:", user.email);
                
                // Muda botão para "SAIR"
                txtAuth.innerText = "Sair";
                iconAuth.className = "fas fa-sign-out-alt"; // Ícone de saída
                btnAuth.href = "#"; // Não vai pra login.html
                
                // Quando clicar em Sair, desloga do Firebase
                btnAuth.onclick = (e) => {
                    e.preventDefault();
                    if(confirm("Deseja realmente sair da conta?")) {
                        signOut(auth).then(() => {
                            window.location.reload(); // Recarrega a página
                        });
                    }
                };

                // Garante que o popup não apareça
                popup.style.display = 'none';

            } else {
                // --- USUÁRIO NÃO ESTÁ LOGADO ---
                console.log("Ninguém logado.");

                // Muda botão para "ENTRAR"
                txtAuth.innerText = "Entrar";
                iconAuth.className = "fas fa-user-circle";
                btnAuth.href = "login.html";
                btnAuth.onclick = null; // Remove a função de sair

                // Mostra popup se a pessoa ainda não fechou
                if (!sessionStorage.getItem('popupFechado')) {
                    popup.style.display = 'flex';
                }
            }
        });
    </script>
  </body>
</html>