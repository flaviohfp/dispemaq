<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loja - Catálogo de Peças</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="./assets/css/style.css" />

    <style>
      /* --- ESTILOS DO NOVO CABEÇALHO (Botões Iguais da Index) --- */
      .header-btn-container {
          position: relative;
          display: flex;
          align-items: center;
          height: 100%;
          margin-right: 20px;
          z-index: 110;
          font-family: inherit;
      }

      .header-btn-trigger {
          display: flex;
          align-items: center;
          gap: 8px;
          text-decoration: none;
          color: white;
          font-size: 0.85rem;
          line-height: 1.2;
          padding: 5px;
          transition: color 0.3s;
          cursor: pointer;
      }

      .header-icon-svg {
          position: relative;
          display: flex;
          align-items: center;
      }

      .header-icon-svg svg {
          width: 28px;
          height: 28px;
          fill: white;
          transition: fill 0.3s;
      }

      /* Hover: Muda cor para laranja */
      .header-btn-container:hover .header-btn-trigger { color: #ff6600; }
      .header-btn-container:hover .header-icon-svg svg { fill: #ff6600; }

      /* Badge do Carrinho */
      .badge-carrinho {
          position: absolute;
          top: -5px;
          right: -8px;
          background-color: #ff6600;
          color: white;
          font-size: 10px;
          font-weight: bold;
          height: 16px;
          min-width: 16px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          border: 2px solid white;
      }

      /* Dropdown Flutuante (Login) */
      .login-dropdown-content {
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%) translateY(15px);
          width: 230px;
          opacity: 0;
          visibility: hidden;
          transition: all 0.3s ease;
          pointer-events: none;
          padding-top: 15px;
          z-index: 120;
      }

      .header-btn-container:hover .login-dropdown-content {
          opacity: 1;
          visibility: visible;
          transform: translateX(-50%) translateY(0px);
          pointer-events: auto;
      }

      .dropdown-arrow {
          position: absolute;
          top: 0px; 
          left: 0; right: 0;
          display: flex; justify-content: center;
          z-index: 112;
      }
      .dropdown-arrow svg {
          fill: #fff;
          filter: drop-shadow(0 -2px 2px rgba(0,0,0,0.08));
      }

      .dropdown-box-inner {
          background-color: #fff;
          border-top: 3px solid #ff6600;
          border-radius: 4px;
          box-shadow: 0 5px 25px rgba(0,0,0,0.15);
          padding: 20px;
          text-align: center;
          display: flex; flex-direction: column; gap: 15px;
          position: relative; z-index: 111;
      }

      .dropdown-title {
          font-size: 0.85rem; font-weight: 700; color: #333; line-height: 1.4;
      }

      .btn-entrar-full {
          display: flex; align-items: center; justify-content: center;
          background-color: #ff6600; color: #fff;
          font-weight: 800; font-size: 0.9rem; text-transform: uppercase;
          text-decoration: none;
          padding: 10px; border-radius: 4px;
          transition: transform 0.2s, background-color 0.2s;
      }
      .btn-entrar-full:hover {
          background-color: #e65c00;
          transform: scale(1.05); 
          color: white;
      }

      .dropdown-bottom-links {
          display: flex; flex-direction: column; gap: 6px;
          font-size: 0.8rem; color: #666;
          border-top: 1px solid #eee; padding-top: 12px;
      }
      .dropdown-bottom-links a { text-decoration: none; color: inherit; }
      .dropdown-bottom-links a strong { color: #ff6600; }

      /* --- ESTILOS EXTRAS PARA FILTROS --- */
      .filtro-item {
          cursor: pointer;
          transition: color 0.2s, background 0.2s;
          padding: 5px 0;
          display: block; /* Garante que o link ocupe a linha */
          text-decoration: none;
          color: #333;
      }
      .filtro-item:hover {
          color: #ff6600;
          padding-left: 5px;
      }
      .filtro-item.ativo {
          font-weight: bold;
          color: #ff6600;
      }

      /* Popup Styles */
      .overlay-popup {
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background: rgba(0,0,0,0.6); z-index: 9999;
          display: none; 
          align-items: center; justify-content: center;
      }
      .box-popup {
          background: white; padding: 30px; border-radius: 10px;
          text-align: center; max-width: 400px; width: 90%; position: relative;
          box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      }
      .fechar-popup {
          position: absolute; top: 10px; right: 15px; font-size: 28px;
          background: none; border: none; cursor: pointer; color: #666;
      }
      .botoes-popup { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
      .texto-pequeno { font-size: 12px; color: #999; margin-top: 15px; }
      .botao-secundario { background-color: #666; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;}
      .botao-primario { background-color: #ff6600; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;}
    </style>
  </head>
  <body>
    <div class="barra-anuncio">
      <div class="container">
        <p>
          <i class="fas fa-shipping-fast"></i> Enviamos para todo o Brasil |
          <i class="fab fa-whatsapp"></i> Atendimento Especializado
        </p>
      </div>
    </div>

    <header class="cabecalho-principal">
      <div class="container">
        <div class="topo-cabecalho">
          
          <a href="index.html" class="logo-empresa">
            <img
              src="./assets/images/SITE-LOGO-ESTENDIDA.-PNG-2048x819.png"
              alt="Logo Empresa"
              onerror="this.src='https://via.placeholder.com/200x80?text=Dispemaq'"
            />
          </a>

          <div class="barra-busca">
            <input
              type="text"
              id="campoBuscaLoja"
              placeholder="Buscar peça, código ou máquina..."
            />
            <button class="botao-buscar" id="btnBuscaLoja"><i class="fas fa-search"></i></button>
          </div>

          <div class="acoes-usuario">
            
            <div class="header-btn-container">
              <a href="cadastro.html" class="header-btn-trigger" id="btnAuth">
                <div class="header-icon-svg">
                  <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#000000" viewBox="0 0 256 256"><path d="M230.93,220a8,8,0,0,1-6.93,4H32a8,8,0,0,1-6.92-12c15.23-26.33,38.7-45.21,66.09-54.16a72,72,0,1,1,73.66,0c27.39,8.95,50.86,27.83,66.09,54.16A8,8,0,0,1,230.93,220Z"></path></svg>
                </div>
                <div class="header-text" id="txtAuth">
                  <strong>Entre</strong> ou<br><strong>Cadastre-se</strong>
                </div>
              </a>

              <div class="login-dropdown-content" id="loginDropdown">
                <div class="dropdown-arrow">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#fff" viewBox="0 0 256 256"><path d="M215.39,163.06A8,8,0,0,1,208,168H48a8,8,0,0,1-5.66-13.66l80-80a8,8,0,0,1,11.32,0l80,80A8,8,0,0,1,215.39,163.06Z"></path></svg>
                </div>
                <div class="dropdown-box-inner">
                  <span class="dropdown-title">Já possui cadastro?<br>Acesse sua conta</span>
                  <a href="login.html" class="btn-entrar-full">ENTRAR</a>
                  <div class="dropdown-bottom-links">
                    <a href="cadastro.html" title="Cadastrar">Cliente novo? <strong>Cadastrar</strong></a>
                    <a href="login.html?pedidos=true" title="Consultar pedido">Consulte seu pedido <strong>acompanhe aqui</strong></a>
                  </div>
                </div>
              </div>
            </div>

            <div class="header-btn-container">
                <a href="#" class="header-btn-trigger" onclick="toggleCarrinho(event)">
                  <div class="header-icon-svg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#000000" viewBox="0 0 256 256"><path d="M222.14,58.87A8,8,0,0,0,216,56H54.68L49.79,29.14A16,16,0,0,0,34.05,16H16a8,8,0,0,0,0,16h18L59.56,172.29a24,24,0,0,0,5.33,11.27,28,28,0,1,0,44.4,8.44h45.42A27.75,27.75,0,0,0,152,204a28,28,0,1,0,28-28H83.17a8,8,0,0,1-7.87-6.57L72.13,152h116a24,24,0,0,0,23.61-19.71l12.16-66.86A8,8,0,0,0,222.14,58.87ZM96,204a12,12,0,1,1-12-12A12,12,0,0,1,96,204Zm96,0a12,12,0,1,1-12-12A12,12,0,0,1,192,204Zm4-74.57A8,8,0,0,1,188.1,136H69.22L57.59,72H206.41Z"></path></svg>
                    <span class="badge-carrinho" id="badgeCarrinhoLoja">0</span>
                  </div>
                  <div class="header-text">
                    <strong>Meu</strong><br>Carrinho
                  </div>
                </a>
            </div>

           

          </div>
        </div>
      </div>
    </header>

    <section class="banner-loja-container" style="max-width: 1400px; margin: 0 auto; padding: 10px;">
        <img 
            id="bannerPrincipal" 
            src="./assets/images/banner-padrao.jpg" 
            alt="Ofertas Especiais" 
            style="width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: block;"
            onerror="this.style.display='none'"
        >
    </section>

    <div class="container dyn-layout-loja" style="margin-top: 30px; margin-bottom: 50px;">
        
        <aside class="sidebar-filtros">
            <div class="box-sidebar">
                <h3><i class="fas fa-filter"></i> Filtrar Por</h3>
                
                <div id="sidebar-dinamica-container">
                    <p style="padding:15px; color:#666; font-size:0.9rem;">
                        <i class="fas fa-spinner fa-spin"></i> Carregando menu...
                    </p>
                </div>

            </div>
        </aside>

        <section class="conteudo-principal-loja">
            <div class="header-resultados">
                <div>
                    <h2 id="tituloResultadoLoja">Todos os Produtos</h2>
                    <p id="qtdResultados" style="color: #666; font-size: 0.9rem;">Carregando...</p>
                </div>
            </div>

            <div id="gradeProdutosLoja" class="dyn-grade-produtos" style="margin-top: 20px;">
                </div>
        </section>
    </div>

    <footer class="rodape-principal">
      <div class="container">
        <div class="conteudo-rodape">
          <div class="coluna-rodape">
            <h3>Sobre Nós</h3>
            <p>Especialistas em peças de reposição para máquinas pesadas e tratores agrícolas.</p>
          </div>
          <div class="coluna-rodape">
            <h4>Links Rápidos</h4>
            <ul class="links-rodape">
              <li><a href="index.html">Início</a></li>
              <li><a href="loja.html">Loja</a></li>
            </ul>
          </div>
          <div class="coluna-rodape">
            <h4>Contato</h4>
            <ul class="info-rodape">
              <li><i class="fas fa-phone-alt"></i> (49) 8427-6503</li>
              <li><i class="fab fa-whatsapp"></i> (49) 8427-6503</li>
            </ul>
          </div>
        </div>
        <div class="rodape-inferior">
          <p>&copy; 2026 Dispemaq. Todos os direitos reservados.</p>
        </div>
      </div>
    </footer>

    <div class="overlay-categorias" id="overlay"></div>
    <div class="carrinho-lateral" id="carrinhoLateral">
        <div class="carrinho-header">
            <h3>Seu Carrinho</h3>
            <button class="fechar-carrinho" onclick="toggleCarrinho(event)">&times;</button>
        </div>
        <div class="carrinho-conteudo" id="itensCarrinhoHtml"></div>
        <div class="carrinho-footer">
            <div class="carrinho-total">
               <span>Total:</span> <strong id="totalCarrinhoLateral">R$ 0,00</strong>
            </div>
            <button class="botao botao-primario botao-block">Finalizar Compra</button>
        </div>
    </div>

    <a href="https://wa.me/554984276503" class="whatsapp-flutuante"><i class="fab fa-whatsapp"></i></a>

    <div id="popupAvisoLogin" class="overlay-popup">
        <div class="box-popup">
            <button class="fechar-popup" onclick="fecharPopupLogin()">&times;</button>
            <h3>Bem-vindo à Dispemaq!</h3>
            <p>Faça login para salvar seus favoritos e finalizar compras com agilidade.</p>
            <div class="botoes-popup">
                <a href="login.html" class="botao botao-primario">Fazer Login</a>
                <a href="cadastro.html" class="botao botao-secundario">Criar Conta</a>
            </div>
            <p class="texto-pequeno">Ou feche para apenas navegar &rarr;</p>
        </div>
    </div>

    <script type="module" src="./assets/js/loja.js"></script>
    
    <script>
        // --- FUNÇÕES DE INTERFACE (Carrinho e Popup) ---
        function toggleCarrinho(e) {
            if(e) e.preventDefault();
            const sidebar = document.getElementById('carrinhoLateral');
            const overlay = document.getElementById('overlay');
            
            if(sidebar) sidebar.classList.toggle('aberto');
            if(overlay) overlay.classList.toggle('ativo');
        }
        
        const overlay = document.getElementById('overlay');
        if(overlay) {
            overlay.addEventListener('click', () => toggleCarrinho());
        }

        window.fecharPopupLogin = function() {
            document.getElementById('popupAvisoLogin').style.display = 'none';
            sessionStorage.setItem('popupFechado', 'true');
        }
    </script>

    <script type="module">
        // --- SCRIPT DE AUTENTICAÇÃO E LÓGICA DO HEADER ---
        import { auth, onAuthStateChanged, signOut } from './assets/js/firebase-config.js';

        const btnAuth = document.getElementById('btnAuth');
        const txtAuth = document.getElementById('txtAuth');
        const dropdown = document.getElementById('loginDropdown'); 
        const popup = document.getElementById('popupAvisoLogin');

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // --- USUÁRIO LOGADO ---
                console.log("Usuário logado:", user.email);
                
                txtAuth.innerHTML = "<strong>Sair</strong><br>da conta";
                if(dropdown) dropdown.style.display = 'none'; 

                btnAuth.removeAttribute('href');
                btnAuth.onclick = (e) => {
                    e.preventDefault();
                    if(confirm("Deseja realmente sair da conta?")) {
                        signOut(auth).then(() => {
                            window.location.reload();
                        });
                    }
                };
                if(popup) popup.style.display = 'none';

            } else {
                // --- USUÁRIO NÃO LOGADO ---
                console.log("Ninguém logado.");

                txtAuth.innerHTML = "<strong>Entre</strong> ou<br><strong>Cadastre-se</strong>";
                if(dropdown) dropdown.style.display = ''; 
                btnAuth.href = "cadastro.html";
                btnAuth.onclick = null; 

                if (popup && !sessionStorage.getItem('popupFechado')) {
                    popup.style.display = 'flex';
                }
            }
        });
    </script>
  </body>
</html>